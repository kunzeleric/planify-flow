# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Planify Flow is a Next.js 16 application using React 19, TypeScript, and Drizzle ORM with PostgreSQL. The project follows Next.js App Router conventions with API routes under `/api/v1/`.

## Development Commands

**Start development server:**
```bash
pnpm dev
```

**Build:**
```bash
pnpm build
```

**Linting and formatting:**
```bash
pnpm lint
pnpm format
```

**Testing:**
```bash
pnpm test              # Run all tests
pnpm test:watch        # Watch mode for development
pnpm coverage          # Generate coverage report
```

**Docker services (PostgreSQL):**
```bash
pnpm services:up       # Start database container
pnpm services:down     # Stop and remove database container
pnpm services:stop     # Stop database container
```

## Architecture

### Database Layer

- **ORM:** Drizzle ORM with PostgreSQL adapter
- **Schema location:** `drizzle/schema.ts` - all database table definitions
- **Migrations:** Stored in `drizzle/migrations/` (auto-generated by Drizzle Kit)
- **Database connection:** Initialized in `src/lib/drizzle.ts` using `node-postgres` pool
- **Database utilities:** Helper functions in `src/lib/drizzle.ts` for fetching DB metadata (version, connections, etc.)

**Running migrations:**
Drizzle Kit reads configuration from `drizzle.config.ts`. Schema changes should be made in `drizzle/schema.ts` and migrations generated using Drizzle Kit CLI.

### API Structure

API routes follow versioned pattern: `/api/v1/[endpoint]`

- Route handlers are in `src/app/api/v1/[endpoint]/route.ts`
- Example: status endpoint at `src/app/api/v1/status/route.ts`
- Uses Next.js App Router route handlers (GET, POST, etc. as exported functions)

### Testing

- **Framework:** Vitest
- **Test location:** `src/tests/` directory mirrors API structure
- **Integration tests:** Test files make actual HTTP requests to `http://localhost:3000`
- **Important:** Tests expect the dev server to be running. Start with `pnpm dev` before running tests.

### Path Aliases

TypeScript is configured with `@/*` alias mapping to `src/*` directory for cleaner imports.

## Environment Setup

Required environment variables in `.env`:
- `DATABASE_URL` - PostgreSQL connection string (e.g., `postgresql://docker:docker@localhost:5432/local_db`)

The local Docker PostgreSQL instance uses:
- Username: `docker`
- Password: `docker`
- Database: `local_db`
- Port: `5432`

## Project Dependencies

Key dependencies:
- **Next.js 16** with webpack bundler (note: `--webpack` flag used in scripts)
- **React 19** (latest version)
- **Drizzle ORM** for database operations
- **TanStack Query** (React Query) for data fetching
- **Tailwind CSS 4** for styling
- **Vitest** for testing
